(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[120],{3172:function(e,a,t){Promise.resolve().then(t.bind(t,7604))},7604:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return c}});var l=t(7437);t(1170);var s=t(2265),n=t(9376),i=t(7648),r=t(4084),o=t(6705);function c(){let[e,a]=(0,s.useState)([]),[t,r]=(0,s.useState)(!0),[c,d]=(0,s.useState)(null),[h,m]=(0,s.useState)(null),[u,p]=(0,s.useState)(null),[x,j]=(0,s.useState)(!1),[g,v]=(0,s.useState)(""),[b,f]=(0,s.useState)(null),N=(0,n.useRouter)(),[y,w]=(0,s.useState)(!1),[k,C]=(0,s.useState)(null),[S,D]=(0,s.useState)(""),[_,Y]=(0,s.useState)(null),[H,A]=(0,s.useState)([]),[E,z]=(0,s.useState)({comparison:!1,details:!1,graph:!1,analysis:!0}),[T,B]=(0,s.useState)(null),[R,M]=(0,s.useState)(null),[O,F]=(0,s.useState)(null),[U,P]=(0,s.useState)(!1);(0,s.useEffect)(()=>{w(!0);let e=localStorage.getItem("token");C(e),e||N.push("/login")},[N]),(0,s.useEffect)(()=>{if(!y||!k)return;r(!0),d(null);let e="".concat("https://my-fastapi-backend-latest.onrender.com","/vitals/history");h&&(e+="?category=".concat(encodeURIComponent(h))),fetch(e,{headers:{Authorization:"Bearer ".concat(k)}}).then(async e=>{if(!e.ok)throw Error("Error ".concat(e.status));a((await e.json()).history||[])}).catch(e=>d(e.message)).finally(()=>r(!1))},[y,k,h]);let V=async()=>{d(null),p(null),j(!0);try{let e=await fetch("".concat("https://my-fastapi-backend-latest.onrender.com","/vitals/compare"),{headers:{Authorization:"Bearer ".concat(k)}});if(!e.ok){let a="Error ".concat(e.status);try{let t=await e.json();a=t.detail||t.message||JSON.stringify(t)}catch(t){a="".concat(e.status," ").concat(e.statusText)}d(a);return}let a=await e.json();if(p(a),a.comparison_data){let e=a.comparison_data.map(e=>e.test_name);A(e)}}catch(e){d((null==e?void 0:e.message)||"Comparison failed.")}finally{j(!1)}},G=e=>{z(a=>({...a,[e]:!a[e]}))},L=async t=>{let l=e.find(e=>e.filename===t);if(window.confirm('Are you sure you want to delete the report "'.concat(l?J(l):t,'"? This action cannot be undone.'))){B(t),M(null),d(null);try{var s;let e=await fetch("".concat("https://my-fastapi-backend-latest.onrender.com","/vitals/").concat(encodeURIComponent(t)),{method:"DELETE",headers:{Authorization:"Bearer ".concat(k)}});if(!e.ok){let a="Failed to delete report: ".concat(e.status," ").concat(e.statusText);try{let t=await e.json();a=t.detail||t.message||a}catch(e){console.error("Could not parse delete error JSON:",e)}throw Error(a)}a(e=>e.filter(e=>e.filename!==t)),g===t&&(v(""),f(null)),u&&(null===(s=u.reports)||void 0===s?void 0:s.some(e=>e.filename===t))&&p(null)}catch(e){console.error("Delete error:",e),M((null==e?void 0:e.message)||"Failed to delete report. Try again.")}finally{B(null)}}},I=async()=>{if(k){d(null),F(null),P(!0);try{let e=await fetch("".concat("https://my-fastapi-backend-latest.onrender.com","/vitals/analyze"),{headers:{Authorization:"Bearer ".concat(k)}});if(!e.ok){let a="Error ".concat(e.status);try{let t=await e.json();a=t.detail||t.message||JSON.stringify(t)}catch(t){a="".concat(e.status," ").concat(e.statusText)}d(a);return}let a=await e.json();F(a),z(e=>({...e,analysis:!1}))}catch(e){d((null==e?void 0:e.message)||"Analysis failed.")}finally{P(!1)}}},J=e=>{let a=e.extracted_data.metadata,t=a.report_date||a.sample_collection_date;if(t){for(let e of["%Y/%m/%d %H:%M","%Y-%m-%d %H:%M","%d/%m/%Y %H:%M","%d-%m-%Y %H:%M","%d/%m/%Y","%d-%m-%Y","%Y/%m/%d","%Y-%m-%d","%d %b %Y %H:%M","%d %B %Y %H:%M","%d %b %Y","%d %B %Y"])try{let a=null;if("%Y/%m/%d %H:%M"===e){let[e,l]=t.split(" "),[s,n,i]=e.split("/").map(Number),[r,o]=l.split(":").map(Number);a=new Date(s,n-1,i,r,o)}else if("%Y-%m-%d %H:%M"===e){let[e,l]=t.split(" "),[s,n,i]=e.split("-").map(Number),[r,o]=l.split(":").map(Number);a=new Date(s,n-1,i,r,o)}else if("%d/%m/%Y %H:%M"===e){let[e,l]=t.split(" "),[s,n,i]=e.split("/").map(Number),[r,o]=l.split(":").map(Number);a=new Date(i,n-1,s,r,o)}else if("%d-%m-%Y %H:%M"===e){let[e,l]=t.split(" "),[s,n,i]=e.split("-").map(Number),[r,o]=l.split(":").map(Number);a=new Date(i,n-1,s,r,o)}else if("%d/%m/%Y"===e){let[e,l,s]=t.split("/").map(Number);a=new Date(s,l-1,e)}else if("%d-%m-%Y"===e){let[e,l,s]=t.split("-").map(Number);a=new Date(s,l-1,e)}else if("%Y/%m/%d"===e){let[e,l,s]=t.split("/").map(Number);a=new Date(e,l-1,s)}else if("%Y-%m-%d"===e){let[e,l,s]=t.split("-").map(Number);a=new Date(e,l-1,s)}else"%d %b %Y %H:%M"===e?a=new Date(t):"%d %B %Y %H:%M"===e?a=new Date(t):"%d %b %Y"===e?a=new Date(t):"%d %B %Y"===e&&(a=new Date(t));if(a&&!isNaN(a.getTime()))return a.toLocaleDateString("en-GB")}catch(e){continue}try{let e=new Date(t);if(!isNaN(e.getTime()))return e.toLocaleDateString("en-GB")}catch(e){}return t}return"Not Available"},W=e=>e.date,Z=()=>{if(!S||!(null==u?void 0:u.comparison_data))return;let e=u.comparison_data.find(e=>e.test_name===S);if(!e)return;let a=[],t=[],l="";e.readings.forEach(e=>{if(e&&"Not Available"!==e.value){a.push(e.date);let s=parseFloat(e.value.replace(/[^\d.-]/g,""));isNaN(s)||(t.push(s),l||!e.unit||(l=e.unit))}}),Y({dates:a,values:t,unit:l})};(0,s.useEffect)(()=>{Z()},[S,u]);let $={labels:(null==_?void 0:_.dates)||[],datasets:[{label:S,data:(null==_?void 0:_.values)||[],borderColor:"rgb(54, 162, 235)",backgroundColor:"rgba(54, 162, 235, 0.2)",tension:.3,fill:!1,pointBackgroundColor:"rgb(54, 162, 235)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(54, 162, 235)",pointRadius:5,pointHoverRadius:7}]},q={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{font:{size:14}}},title:{display:!0,text:S?"".concat(S," Trend Over Time"):"Select a Vital to View Trend",font:{size:16,weight:"bold"},padding:{top:10,bottom:20}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleFont:{size:14},bodyFont:{size:13},callbacks:{label:function(e){return"".concat(e.dataset.label,": ").concat(e.parsed.y," ").concat((null==_?void 0:_.unit)||"")}}}},scales:{y:{beginAtZero:!1,title:{display:!0,text:(null==_?void 0:_.unit)||"",font:{size:13,weight:"bold"}},grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{title:{display:!0,text:"Date",font:{size:13,weight:"bold"}},grid:{color:"rgba(0, 0, 0, 0.05)"}}},interaction:{mode:"index",intersect:!1}};return y?(0,l.jsxs)("div",{className:"vitals-history-page-wrapper",children:[(0,l.jsxs)("nav",{className:"navbar",children:[(0,l.jsx)(i.default,{href:"/",className:"navbar-brand",children:"Swastha"}),(0,l.jsxs)("div",{className:"navbar-links",children:[(0,l.jsx)(i.default,{href:"/dashboard",className:"navbar-link",children:"Dashboard"}),(0,l.jsx)(i.default,{href:"/upload",className:"navbar-link",children:"Upload"}),(0,l.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),N.push("/login")},className:"navbar-link",children:"Logout"})]})]}),(0,l.jsx)("div",{className:"vitals-history-container",children:(0,l.jsxs)("div",{className:"vitals-history-card",children:[(0,l.jsx)("h1",{className:"vitals-history-title",children:"Vitals History & Comparison"}),t&&(0,l.jsx)("div",{className:"loading",children:"Loading vitals history..."}),c&&(0,l.jsxs)("div",{className:"alert alert-error",children:[(0,l.jsx)("strong",{children:"Error:"})," ",c,(0,l.jsx)("button",{onClick:()=>d(null),className:"dismiss-btn",children:"Dismiss"})]}),R&&(0,l.jsxs)("div",{className:"alert alert-error",children:[(0,l.jsx)("strong",{children:"Delete failed:"})," ",R,(0,l.jsx)("button",{onClick:()=>M(null),className:"dismiss-btn",children:"Dismiss"})]}),0!==e.length||t?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"controls",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{children:"Category:"}),(0,l.jsxs)("select",{value:h||"",onChange:e=>m(e.target.value||null),children:[(0,l.jsx)("option",{value:"",children:"All"}),(0,l.jsx)("option",{value:"General",children:"General"}),(0,l.jsx)("option",{value:"Cardiology",children:"Cardiology"}),(0,l.jsx)("option",{value:"Endocrinology",children:"Endocrinology"}),(0,l.jsx)("option",{value:"Neurologist",children:"Neurologist"}),(0,l.jsx)("option",{value:"Urologist",children:"Urologist"}),(0,l.jsx)("option",{value:"Psychologist",children:"Psychologist"}),(0,l.jsx)("option",{value:"Dentist",children:"Dentist"}),(0,l.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,l.jsx)("button",{onClick:V,disabled:x,children:x?"Processing...":"Compare All Reports"}),(0,l.jsx)("button",{onClick:I,disabled:U,className:"analyze-button",children:U?"Analyzing...":"Analyze Trends"})]}),O&&(0,l.jsxs)("div",{className:"collapsible-section analysis-section",children:[(0,l.jsxs)("div",{className:"collapsible-header analysis-header",children:[(0,l.jsx)("h2",{children:"AI Health Analysis"}),(0,l.jsx)("button",{className:"toggle-button analysis-toggle-button",onClick:()=>G("analysis"),children:E.analysis?"Show":"Hide"})]}),(0,l.jsx)("div",{className:"collapsible-content analysis-content ".concat(E.analysis?"collapsed":""),children:(0,l.jsxs)("div",{className:"analysis-alerts-section",children:[(0,l.jsx)("h3",{className:"analysis-subtitle",children:"Potential Health Alerts"}),O.analysis.alerts&&O.analysis.alerts.length>0?(0,l.jsx)("ul",{className:"analysis-list analysis-alerts-list",children:O.analysis.alerts.map((e,a)=>(0,l.jsxs)("li",{className:"analysis-list-item analysis-alert-item",children:[(0,l.jsx)("span",{className:"analysis-item-icon",children:"⚠️"}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:[e.test_name,":"]})," ",e.message]})]},a))}):(0,l.jsx)("p",{className:"analysis-no-data",children:"No significant alerts detected based on recent trends."})]})})]}),u&&(0,l.jsxs)("div",{className:"collapsible-section",children:[(0,l.jsxs)("div",{className:"collapsible-header",children:[(0,l.jsx)("h2",{children:u.message||"Comparison Result"}),(0,l.jsx)("button",{className:"toggle-button",onClick:()=>G("comparison"),children:E.comparison?"Show":"Hide"})]}),(0,l.jsx)("div",{className:"collapsible-content ".concat(E.comparison?"collapsed":""),children:u.comparison_data&&u.comparison_data.length>0&&u.reports?(0,l.jsxs)("table",{className:"comparison-table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Test Name"}),u.reports.map((e,a)=>(0,l.jsx)("th",{children:W(e)},a))]})}),(0,l.jsx)("tbody",{children:u.comparison_data.map((e,a)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.test_name}),e.readings.map((e,a)=>(0,l.jsx)("td",{children:e?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("strong",{children:e.value})," ",e.unit,e.remarks&&(0,l.jsx)("div",{className:"remarks",children:e.remarks})]}):(0,l.jsx)("em",{children:"Not Available"})},a))]},a))})]}):(0,l.jsx)("p",{children:"No data available."})})]}),(0,l.jsxs)("div",{className:"collapsible-section",children:[(0,l.jsxs)("div",{className:"collapsible-header",children:[(0,l.jsx)("h2",{children:"Vital Trends"}),(0,l.jsx)("button",{className:"toggle-button",onClick:()=>G("graph"),children:E.graph?"Show":"Hide"})]}),(0,l.jsxs)("div",{className:"collapsible-content ".concat(E.graph?"collapsed":""),children:[(0,l.jsxs)("div",{className:"graph-controls",children:[(0,l.jsx)("label",{htmlFor:"vital-selector",children:"Select Vital:"}),(0,l.jsxs)("select",{id:"vital-selector",value:S,onChange:e=>D(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select a vital"}),H.map((e,a)=>(0,l.jsx)("option",{value:e,children:e},a))]})]}),(0,l.jsx)("div",{className:"chart-container",children:S&&_?(0,l.jsx)(o.x1,{data:$,options:q}):(0,l.jsx)("div",{className:"chart-placeholder",children:(0,l.jsx)("p",{children:"Select a vital parameter to visualize its trend over time"})})})]})]}),(0,l.jsxs)("div",{className:"detail-controls",children:[(0,l.jsx)("label",{children:"View Report Details:"}),(0,l.jsxs)("select",{value:g,onChange:e=>v(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select"}),e.map(e=>(0,l.jsx)("option",{value:e.filename,children:J(e)},e.filename))]}),(0,l.jsx)("button",{onClick:()=>{if(!g){f(null);return}f(e.find(e=>e.filename===g)||null),p(null),z(e=>({...e,details:!1}))},children:"View Details"})]}),b&&(0,l.jsxs)("div",{className:"collapsible-section",children:[(0,l.jsxs)("div",{className:"collapsible-header",children:[(0,l.jsx)("h2",{children:"Report Details"}),(0,l.jsx)("button",{className:"toggle-button",onClick:()=>G("details"),children:E.details?"Show":"Hide"})]}),(0,l.jsxs)("div",{className:"collapsible-content ".concat(E.details?"collapsed":""),children:[(0,l.jsx)("h3",{children:J(b)}),(0,l.jsx)("div",{className:"metadata",children:Object.entries(b.extracted_data.metadata).map(e=>{let[a,t]=e;return(0,l.jsxs)("p",{children:[(0,l.jsxs)("strong",{children:[a.replace(/_/g," "),":"]})," ",t||"N/A"]},a)})}),b.extracted_data.results.map((e,a)=>(0,l.jsxs)("div",{className:"section",children:[e.section&&(0,l.jsx)("h3",{children:e.section}),(0,l.jsxs)("table",{className:"detail-view-table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Test"}),(0,l.jsx)("th",{children:"Result"}),(0,l.jsx)("th",{children:"Unit"}),(0,l.jsx)("th",{children:"Range"}),(0,l.jsx)("th",{children:"Remarks"})]})}),(0,l.jsx)("tbody",{children:e.tests.map((e,a)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.test_name}),(0,l.jsx)("td",{children:e.result}),(0,l.jsx)("td",{children:e.unit}),(0,l.jsx)("td",{children:e.reference_range}),(0,l.jsx)("td",{children:e.remarks||"–"})]},a))})]})]},a))]})]}),(0,l.jsxs)("div",{className:"manage-reports-section",children:[(0,l.jsx)("h2",{className:"manage-reports-title",children:"Manage Your Reports"}),(0,l.jsxs)("p",{className:"manage-reports-description",children:["Select a report category to view and delete individual reports.",(0,l.jsx)("br",{}),(0,l.jsx)("strong",{children:"Warning:"})," Deleting a report is permanent."]}),(0,l.jsxs)("div",{className:"manage-reports-filter",children:[(0,l.jsx)("label",{htmlFor:"manage-category-filter",className:"manage-reports-label",children:"Filter by Category:"}),(0,l.jsxs)("select",{id:"manage-category-filter",value:h||"",onChange:e=>m(e.target.value||null),className:"manage-reports-select",children:[(0,l.jsx)("option",{value:"",children:"All Categories"}),(0,l.jsx)("option",{value:"General",children:"General"}),(0,l.jsx)("option",{value:"Cardiology",children:"Cardiology"}),(0,l.jsx)("option",{value:"Endocrinology",children:"Endocrinology"}),(0,l.jsx)("option",{value:"Neurologist",children:"Neurologist"}),(0,l.jsx)("option",{value:"Urologist",children:"Urologist"}),(0,l.jsx)("option",{value:"Psychologist",children:"Psychologist"}),(0,l.jsx)("option",{value:"Dentist",children:"Dentist"}),(0,l.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,l.jsxs)("div",{className:"manage-reports-list",children:[e.filter(e=>!h||e.category===h).map(e=>(0,l.jsxs)("div",{className:"manage-report-item",children:[(0,l.jsxs)("span",{className:"manage-report-info",children:[J(e)," (",e.category,")"]}),(0,l.jsx)("button",{onClick:()=>L(e.filename),disabled:T===e.filename,className:"manage-report-delete-button",children:T===e.filename?"Deleting...":"Delete"})]},e.filename)),0===e.filter(e=>!h||e.category===h).length&&(0,l.jsx)("p",{className:"manage-reports-empty",children:"No reports found in this category."})]})]})]}):(0,l.jsxs)("div",{className:"empty-state",children:[(0,l.jsx)("p",{children:"No reports found."}),(0,l.jsx)(i.default,{href:"/upload",children:"Upload a new report"})]})]})})]}):null}r.kL.register(r.uw,r.f$,r.od,r.jn,r.Dx,r.u,r.De)},1170:function(){}},function(e){e.O(0,[752,674,648,729,971,117,744],function(){return e(e.s=3172)}),_N_E=e.O()}]);