(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{4384:function(e,a,l){Promise.resolve().then(l.bind(l,112))},112:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return n}});var r=l(7437);l(4403);var s=l(2265),i=l(9376);function n(){let[e,a]=(0,s.useState)(!1),[l,n]=(0,s.useState)(null),[o,t]=(0,s.useState)(null),[c,d]=(0,s.useState)(!0),[f,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(null),[p,v]=(0,s.useState)({full_name:"",age:"",gender:"",email:""}),[N,j]=(0,s.useState)(!1),x=(0,i.useRouter)();(0,s.useEffect)(()=>{a(!0);let e=localStorage.getItem("token");n(e),e||x.push("/login")},[x]),(0,s.useEffect)(()=>{e&&l&&(async()=>{try{var e;let a;d(!0),u(null),h(null);let r=await fetch("".concat("https://my-fastapi-backend-latest.onrender.com","/auth/user/profile"),{method:"GET",headers:{Authorization:"Bearer ".concat(l),"Content-Type":"application/json"}});if(!r.ok){if(401===r.status){console.warn("Unauthorized access in profile, redirecting to login."),localStorage.removeItem("token"),x.push("/login");return}let e="Failed to fetch profile: ".concat(r.status," ").concat(r.statusText);try{e=(await r.json()).detail||e}catch(e){console.error("Failed to parse error response:",e)}throw Error(e)}try{a=await r.json()}catch(e){throw console.error("Failed to parse profile JSON:",e),Error("Received invalid data format from server.")}if(!a||"object"!=typeof a||Array.isArray(a))throw console.error("Unexpected profile data format:",a),Error("Received unexpected data structure from server.");let s=a;t(s),v({full_name:s.full_name||"",age:(null===(e=s.age)||void 0===e?void 0:e.toString())||"",gender:s.gender||"",email:s.email||""})}catch(e){console.error("Fetch user profile error in profile page:",e),u(e.message||e.toString()||"Failed to load user profile. Please try again later."),t(null)}finally{d(!1)}})()},[l,e,x]);let g=e=>{let{name:a,value:l}=e.target;v(e=>({...e,[a]:l}))},b=async e=>{if(e.preventDefault(),l)try{var a;d(!0),u(null),h(null);let e=parseInt(p.age,10);if(isNaN(e)||e<=0||e>120)throw Error("Please enter a valid age between 1 and 120.");let r=await fetch("".concat("https://my-fastapi-backend-latest.onrender.com","/auth/user/profile"),{method:"PUT",headers:{Authorization:"Bearer ".concat(l),"Content-Type":"application/json"},body:JSON.stringify({full_name:p.full_name,age:e,gender:p.gender})});if(!r.ok){if(401===r.status){localStorage.removeItem("token"),x.push("/login");return}let e="Failed to update profile: ".concat(r.status," ").concat(r.statusText);try{e=(await r.json()).detail||e}catch(e){console.error("Failed to parse error response:",e)}throw Error(e)}let s=await r.json();t(s),h("Profile updated successfully!"),j(!1),v({full_name:s.full_name||"",age:(null===(a=s.age)||void 0===a?void 0:a.toString())||"",gender:s.gender||"",email:s.email||""})}catch(e){console.error("Update profile error:",e),u(e.message||e.toString()||"Failed to update profile. Please try again later.")}finally{d(!1)}},y=()=>{localStorage.removeItem("token"),x.push("/login")};return e?c&&!o?(0,r.jsxs)("div",{className:"profile-page-wrapper",children:[(0,r.jsxs)("nav",{className:"navbar",children:[(0,r.jsx)("a",{href:"/",className:"navbar-brand",children:"Swastha"}),(0,r.jsxs)("div",{className:"navbar-links",children:[(0,r.jsx)("a",{href:"/dashboard",className:"navbar-link",children:"Dashboard"}),(0,r.jsx)("a",{href:"/upload",className:"navbar-link",children:"Upload"}),(0,r.jsx)("a",{href:"/vitals-history",className:"navbar-link",children:"History"}),(0,r.jsx)("a",{href:"/profile",className:"navbar-link active",children:"Profile"}),(0,r.jsx)("button",{onClick:y,className:"navbar-link",children:"Logout"})]})]}),(0,r.jsx)("div",{className:"profile-container",children:(0,r.jsx)("div",{className:"profile-loading",children:"Loading your profile..."})})]}):f&&!o?(0,r.jsxs)("div",{className:"profile-page-wrapper",children:[(0,r.jsxs)("nav",{className:"navbar",children:[(0,r.jsx)("a",{href:"/",className:"navbar-brand",children:"Swastha"}),(0,r.jsxs)("div",{className:"navbar-links",children:[(0,r.jsx)("a",{href:"/dashboard",className:"navbar-link",children:"Dashboard"}),(0,r.jsx)("a",{href:"/upload",className:"navbar-link",children:"Upload"}),(0,r.jsx)("a",{href:"/vitals-history",className:"navbar-link",children:"History"}),(0,r.jsx)("button",{onClick:y,className:"navbar-link",children:"Logout"})]})]}),(0,r.jsx)("div",{className:"profile-container",children:(0,r.jsxs)("div",{className:"profile-error",children:["Error loading profile: ",f]})})]}):(0,r.jsxs)("div",{className:"profile-page-wrapper",children:[(0,r.jsxs)("nav",{className:"navbar",children:[(0,r.jsx)("a",{href:"/",className:"navbar-brand",children:"Swastha"}),(0,r.jsxs)("div",{className:"navbar-links",children:[(0,r.jsx)("a",{href:"/dashboard",className:"navbar-link",children:"Dashboard"}),(0,r.jsx)("a",{href:"/upload",className:"navbar-link",children:"Upload"}),(0,r.jsx)("a",{href:"/vitals-history",className:"navbar-link",children:"History"}),(0,r.jsx)("a",{href:"/profile",className:"navbar-link active",children:"Profile"}),(0,r.jsx)("button",{onClick:y,className:"navbar-link",children:"Logout"})]})]}),(0,r.jsx)("div",{className:"profile-container",children:(0,r.jsxs)("div",{className:"profile-card",children:[(0,r.jsx)("div",{className:"profile-header",children:(0,r.jsx)("h1",{className:"profile-title",children:"Your Profile"})}),f&&(0,r.jsx)("div",{className:"profile-error-message",children:f}),m&&(0,r.jsx)("div",{className:"profile-success-message",children:m}),(0,r.jsxs)("div",{className:"profile-content",children:[(0,r.jsx)("div",{className:"profile-picture-section",children:(0,r.jsxs)("div",{className:"profile-picture-placeholder",children:[(0,r.jsx)("div",{className:"profile-picture-icon",children:"\uD83D\uDC64"}),(0,r.jsx)("p",{className:"profile-picture-text",children:"Profile Photo"})]})}),(0,r.jsx)("div",{className:"profile-info-section",children:N?(0,r.jsxs)("form",{className:"profile-edit-form",onSubmit:b,children:[(0,r.jsxs)("div",{className:"profile-form-group",children:[(0,r.jsx)("label",{htmlFor:"full_name",className:"profile-form-label",children:"Full Name"}),(0,r.jsx)("input",{id:"full_name",name:"full_name",type:"text",value:p.full_name,onChange:g,className:"profile-form-input",required:!0})]}),(0,r.jsxs)("div",{className:"profile-form-group",children:[(0,r.jsx)("label",{htmlFor:"email",className:"profile-form-label",children:"Email"}),(0,r.jsx)("input",{id:"email",name:"email",type:"email",value:p.email,onChange:g,className:"profile-form-input",disabled:!0}),(0,r.jsx)("p",{className:"profile-form-hint",children:"Email cannot be changed"})]}),(0,r.jsxs)("div",{className:"profile-form-group",children:[(0,r.jsx)("label",{htmlFor:"age",className:"profile-form-label",children:"Age"}),(0,r.jsx)("input",{id:"age",name:"age",type:"number",value:p.age,onChange:g,className:"profile-form-input",min:"1",max:"120",required:!0})]}),(0,r.jsxs)("div",{className:"profile-form-group",children:[(0,r.jsx)("label",{htmlFor:"gender",className:"profile-form-label",children:"Gender"}),(0,r.jsxs)("select",{id:"gender",name:"gender",value:p.gender,onChange:g,className:"profile-form-select",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select Gender"}),(0,r.jsx)("option",{value:"Male",children:"Male"}),(0,r.jsx)("option",{value:"Female",children:"Female"}),(0,r.jsx)("option",{value:"Other",children:"Other"}),(0,r.jsx)("option",{value:"Prefer not to say",children:"Prefer not to say"})]})]}),(0,r.jsxs)("div",{className:"profile-form-actions",children:[(0,r.jsx)("button",{type:"submit",className:"profile-save-button",disabled:c,children:c?"Saving...":"Save Changes"}),(0,r.jsx)("button",{type:"button",className:"profile-cancel-button",onClick:()=>{if(o){var e;v({full_name:o.full_name||"",age:(null===(e=o.age)||void 0===e?void 0:e.toString())||"",gender:o.gender||"",email:o.email||""})}j(!1),u(null),h(null)},disabled:c,children:"Cancel"})]})]}):(0,r.jsxs)("div",{className:"profile-view",children:[(0,r.jsxs)("div",{className:"profile-info-group",children:[(0,r.jsx)("label",{className:"profile-info-label",children:"Full Name"}),(0,r.jsx)("p",{className:"profile-info-value",children:(null==o?void 0:o.full_name)||"N/A"})]}),(0,r.jsxs)("div",{className:"profile-info-group",children:[(0,r.jsx)("label",{className:"profile-info-label",children:"Email"}),(0,r.jsx)("p",{className:"profile-info-value",children:(null==o?void 0:o.email)||"N/A"})]}),(0,r.jsxs)("div",{className:"profile-info-group",children:[(0,r.jsx)("label",{className:"profile-info-label",children:"Age"}),(0,r.jsx)("p",{className:"profile-info-value",children:(null==o?void 0:o.age)||"N/A"})]}),(0,r.jsxs)("div",{className:"profile-info-group",children:[(0,r.jsx)("label",{className:"profile-info-label",children:"Gender"}),(0,r.jsx)("p",{className:"profile-info-value",children:(null==o?void 0:o.gender)||"N/A"})]}),(0,r.jsx)("button",{className:"profile-edit-button",onClick:()=>j(!0),children:"Edit Profile"})]})})]})]})})]}):null}},9376:function(e,a,l){"use strict";var r=l(5475);l.o(r,"useRouter")&&l.d(a,{useRouter:function(){return r.useRouter}})},4403:function(){}},function(e){e.O(0,[974,971,117,744],function(){return e(e.s=4384)}),_N_E=e.O()}]);