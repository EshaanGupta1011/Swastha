(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{8545:function(a,e,r){Promise.resolve().then(r.bind(r,1720))},1720:function(a,e,r){"use strict";r.r(e),r.d(e,{default:function(){return n}});var s=r(7437);r(1203);var t=r(2265),o=r(9376),l=r(7648);function n(){let[a,e]=(0,t.useState)(!1),[r,n]=(0,t.useState)(null),[c,d]=(0,t.useState)(null),[i,h]=(0,t.useState)(!0),[u,m]=(0,t.useState)(null),[f,p]=(0,t.useState)([]),[y,b]=(0,t.useState)(!0),[v,j]=(0,t.useState)(null),x=(0,o.useRouter)(),N=()=>{localStorage.removeItem("token"),x.push("/login")};return((0,t.useEffect)(()=>{e(!0);let a=localStorage.getItem("token");n(a),a||x.push("/login")},[x]),(0,t.useEffect)(()=>{a&&r&&(async()=>{try{let a;h(!0),m(null);let e=await fetch("".concat("https://my-fastapi-backend-latest.onrender.com","/auth/user/profile"),{method:"GET",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(!e.ok){if(401===e.status){console.warn("Unauthorized access in dashboard, redirecting to login."),localStorage.removeItem("token"),x.push("/login");return}let a="Failed to fetch profile: ".concat(e.status," ").concat(e.statusText);try{a=(await e.json()).detail||a}catch(a){console.error("Failed to parse error response:",a)}throw Error(a)}try{a=await e.json()}catch(a){throw console.error("Failed to parse profile JSON:",a),Error("Received invalid data format from server.")}if(!a||"object"!=typeof a||Array.isArray(a))throw console.error("Unexpected profile data format:",a),Error("Received unexpected data structure from server.");let s=a;d(s)}catch(a){console.error("Fetch user profile error in dashboard:",a),m(a.message||a.toString()||"Failed to load user profile. Please try again later."),d(null)}finally{h(!1)}})()},[r,a,x]),(0,t.useEffect)(()=>{a&&r&&(async()=>{try{let a;b(!0),j(null);let e=await fetch("".concat("https://my-fastapi-backend-latest.onrender.com","/vitals/history"),{method:"GET",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(!e.ok){if(401===e.status){console.warn("Unauthorized access fetching report summary, redirecting to login."),localStorage.removeItem("token"),x.push("/login");return}let a="Failed to fetch report summary: ".concat(e.status," ").concat(e.statusText);try{a=(await e.json()).detail||a}catch(a){console.error("Failed to parse summary error response:",a)}throw Error(a)}try{a=await e.json()}catch(a){throw console.error("Failed to parse summary JSON:",a),Error("Received invalid summary data format from server.")}let s=[];if(a.history&&Array.isArray(a.history)){let e={};a.history.forEach(a=>{let r=a.category||"Uncategorized";e[r]=(e[r]||0)+1}),(s=Object.entries(e).map(a=>{let[e,r]=a;return{category:e,count:r}})).sort((a,e)=>a.category.localeCompare(e.category))}else console.warn("Unexpected data structure for report summary:",a),s=[];p(s)}catch(a){console.error("Fetch report summary error in dashboard:",a),j(a.message||a.toString()||"Failed to load report summary. Please try again later."),p([])}finally{b(!1)}})()},[r,a,x]),a)?i||y?(0,s.jsxs)("div",{className:"dashboard-page-wrapper",children:[" ",(0,s.jsxs)("nav",{className:"navbar",children:[(0,s.jsx)(l.default,{href:"/",className:"navbar-brand",children:"Swastha"}),(0,s.jsxs)("div",{className:"navbar-links",children:[(0,s.jsx)(l.default,{href:"/upload",className:"navbar-link",children:"Upload"}),(0,s.jsx)(l.default,{href:"/vitals-history",className:"navbar-link",children:"History"}),(0,s.jsx)(l.default,{href:"/profile",className:"navbar-link",children:"Profile"}),(0,s.jsx)("button",{onClick:N,className:"navbar-link",children:"Logout"})]})]}),(0,s.jsx)("div",{className:"dashboard-container",children:(0,s.jsx)("div",{className:"dashboard-loading",children:"Loading your dashboard..."})})]}):u||v?(0,s.jsxs)("div",{className:"dashboard-page-wrapper",children:[" ",(0,s.jsxs)("nav",{className:"navbar",children:[(0,s.jsx)(l.default,{href:"/",className:"navbar-brand",children:"Swastha"}),(0,s.jsxs)("div",{className:"navbar-links",children:[(0,s.jsx)(l.default,{href:"/upload",className:"navbar-link",children:"Upload"}),(0,s.jsx)(l.default,{href:"/vitals-history",className:"navbar-link",children:"History"}),(0,s.jsx)(l.default,{href:"/profile",className:"navbar-link",children:"Profile"}),(0,s.jsx)("button",{onClick:N,className:"navbar-link",children:"Logout"})]})]}),(0,s.jsx)("div",{className:"dashboard-container",children:(0,s.jsxs)("div",{className:"dashboard-error",children:["Error loading dashboard: ",u||v]})})]}):(0,s.jsxs)("div",{className:"dashboard-page-wrapper",children:[" ",(0,s.jsxs)("nav",{className:"navbar",children:[(0,s.jsx)(l.default,{href:"/",className:"navbar-brand",children:"Swastha"}),(0,s.jsxs)("div",{className:"navbar-links",children:[(0,s.jsx)(l.default,{href:"/upload",className:"navbar-link",children:"Upload"}),(0,s.jsx)(l.default,{href:"/vitals-history",className:"navbar-link",children:"History"}),(0,s.jsx)(l.default,{href:"/profile",className:"navbar-link",children:"Profile"}),(0,s.jsx)("button",{onClick:N,className:"logout-navbar-link",children:"Logout"})]})]}),(0,s.jsx)("div",{className:"dashboard-container",children:(0,s.jsx)("main",{className:"dashboard-main-content",children:(0,s.jsxs)("div",{className:"dashboard-welcome-card",children:[(0,s.jsx)("header",{className:"dashboard-header",children:(0,s.jsxs)("h1",{className:"dashboard-title",children:["Welcome, ",c?c.full_name:"User","!"]})}),(0,s.jsxs)("div",{className:"dashboard-welcome-content",children:[(0,s.jsx)("p",{className:"dashboard-welcome-text",children:"Swastha helps you take control of your health journey."}),(0,s.jsxs)("div",{className:"dashboard-summary-section",children:[(0,s.jsx)("h2",{className:"dashboard-summary-title",children:"Your Reports Summary"}),f.length>0?(0,s.jsx)("div",{className:"dashboard-summary-grid",children:f.map(a=>(0,s.jsxs)("div",{className:"dashboard-summary-item",children:[(0,s.jsx)("span",{className:"dashboard-summary-count",children:a.count}),(0,s.jsxs)(l.default,{href:"/vitals-history?category=".concat(encodeURIComponent(a.category)),className:"dashboard-summary-category-link",children:[a.category," Reports"]}),(0,s.jsxs)("p",{className:"dashboard-summary-description",children:["View and manage your ",a.category.toLowerCase()," ","reports."]})]},a.category))}):(0,s.jsxs)("p",{className:"dashboard-summary-empty",children:["You haven't uploaded any reports yet."," ",(0,s.jsx)(l.default,{href:"/upload",className:"dashboard-summary-upload-link",children:"Upload your first report"})]})]})]}),(0,s.jsxs)("div",{className:"dashboard-actions-grid",children:[(0,s.jsxs)("div",{className:"dashboard-action-card",children:[(0,s.jsx)("h3",{className:"dashboard-action-card-title",children:"Track Your Health Over Time"}),(0,s.jsx)("p",{className:"dashboard-action-card-text",children:"View your uploaded reports, see historical data, and compare results to monitor changes in key vitals."}),(0,s.jsx)(l.default,{href:"/vitals-history",className:"dashboard-action-card-link",children:"View & Compare"})]}),(0,s.jsxs)("div",{className:"dashboard-action-card",children:[(0,s.jsx)("h3",{className:"dashboard-action-card-title",children:"Add New Report"}),(0,s.jsx)("p",{className:"dashboard-action-card-text",children:"Upload a new medical report to start tracking your health data."}),(0,s.jsx)(l.default,{href:"/upload",className:"dashboard-action-card-link",children:"Upload"})]})]})]})})})]}):null}},9376:function(a,e,r){"use strict";var s=r(5475);r.o(s,"useRouter")&&r.d(e,{useRouter:function(){return s.useRouter}})},1203:function(){}},function(a){a.O(0,[731,648,971,117,744],function(){return a(a.s=8545)}),_N_E=a.O()}]);